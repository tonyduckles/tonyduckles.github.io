<!DOCTYPE html>
<html>
<head>
    
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>svn2svn &#8211; Nynim.org</title>
    <link rel="dns-prefetch" href="//maxcdn.bootstrapcdn.com">
    <link rel="dns-prefetch" href="//cdnjs.cloudflare.com">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Tony Duckles on programming, photography, and general geekery
">
    <meta name="robots" content="all">
    <meta name="author" content="Tony Duckles">
    
    
    <link rel="canonical" href="http://nynim.org/code/svn2svn/">
    <link rel="alternate" type="application/atom" title="Nynim.org" href="/atom.xml" />
    <link href="/favicon.png" rel="icon">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/pixyll.css?201708182152" type="text/css">
    <link href='/stylesheets/all-958d45fee415f2d267d37b7939d5bff3.css' media='all' rel='stylesheet' type='text/css'>

    <!-- Fonts -->
    
    <link href='//fonts.googleapis.com/css?family=Merriweather:900,900italic,300,300italic' rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Lato:900,300' rel='stylesheet' type='text/css'>
    
    
      <link href="//maxcdn.bootstrapcdn.com/font-awesome/latest/css/font-awesome.min.css" rel="stylesheet">
    

    <!-- MathJax -->
    

    <!-- Verifications -->
    
    

    <!-- Open Graph -->
    <!-- From: https://github.com/mmistakes/hpstr-jekyll-theme/blob/master/_includes/head.html -->
    <meta property="og:locale" content="en_US">
    <meta property="og:type" content="article">
    <meta property="og:title" content="svn2svn">
    <meta property="og:description" content="Tony Duckles on programming, photography, and general geekery
">
    <meta property="og:url" content="http://nynim.org/code/svn2svn/">
    <meta property="og:site_name" content="Nynim.org">
    

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary" />
    
        <meta name="twitter:site" content="@tonyduckles" />
        <meta name="twitter:creator" content="@tonyduckles" />
    
    <meta name="twitter:title" content="svn2svn" />
    <meta name="twitter:description" content="Tony Duckles on programming, photography, and general geekery
" />
    <meta name="twitter:url" content="http://nynim.org/code/svn2svn/" />
    

    
    <script type="text/javascript">
       (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
       (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
       m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
       })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
       ga('create', 'UA-6748678-1', 'auto');
       ga('send', 'pageview');
    </script>
    
</head>
<body class="site">
  
	

  <div class="site-wrap">
    <header class="site-header px2 px-responsive">
  <div class="mt2 wrap">
    <div class="measure">
      <a href="http://nynim.org" class="site-title">nynim.org</a>
      <nav class="site-nav">
        <a href="/blog/">Blog</a>
    

    

    
    
    
    
        <a href="/blog/archives/">Archives</a>
    

    

    
    
    
    
        <a href="/code/">Code</a>
    

    

    
    
    
    
        <a href="/guitar-tabs/">Guitar Tabs</a>
    

    

    
    
    
    
        <a href="/about/">About</a>
      </nav>
      <div class="clearfix"></div>
      
        <div class="social-icons">
  <div class="social-icons-right">
    
      <a class="fa fa-github" href="https://github.com/tonyduckles"></a>
    
    
    
    
    
      <a class="fa fa-twitter" href="https://twitter.com/tonyduckles"></a>
    
    
    
    
    
      <a class="fa fa-linkedin" href="https://www.linkedin.com/in/tonyduckles"></a>
    
    
    
    
    
    
      <a class="fa fa-instagram" href="https://www.instagram.com/tonyduckles"></a>
    
    
      <a class="fa fa-flickr" href="https://www.flickr.com/photos/tonyduckles"></a>
    
    
      <a class="fa fa-lastfm" href="https://last.fm/user/tonyduckles"></a>
    
    
      <a class="fa fa-thumb-tack" href="https://pinboard.in/u:tduckles"></a>
    
    <a class="fa fa-rss" href="/atom.xml"></a>
    <a class="fa fa-envelope" href="mailto:tony@nynim.org"></a>
  </div>
  <div class="right">
    
    
    
  </div>
</div>
<div class="clearfix"></div>
      
    </div>
  </div>
</header>

    <div class="post p2 p-responsive wrap" role="main">
      <div class="measure">
        <div class="post">
  <header class="post-header">
    <h1 class="h1">svn2svn</h1>
  </header>
  <article class="post-content">
  <p>Replicate (replay) changesets from one Subversion repository to another.</p>

<h2 id="features">Features</h2>
<ul>
  <li><strong>Meant for replaying history into an "empty target location</strong>. This could be
an empty target repo or simply an empty folder/branch in the target repo.</li>
  <li><strong>Maintains logical history (ancestry) when possible</strong>, e.g. uses "svn copy"
for renames.</li>
  <li><strong>Maintains original commit messages</strong>.</li>
  <li><strong>Optionally maintain source commit authors (<code class="highlighter-rouge">svn:author</code>) and commit timestamps
(<code class="highlighter-rouge">svn:date</code>)</strong>.  Requires a "pre-revprop-change" hook script in the target
repo, to be able to change the "<code class="highlighter-rouge">svn:author</code>" and "<code class="highlighter-rouge">svn:date</code>" revprops after
target commits have been made.</li>
  <li><strong>Optionally maintain identical revision #'s between source vs. target repo</strong>.
Effectively requires that you're replaying into an empty target repo,
or rather that the first source repo revision to be replayed is less than
the last target repo revision. Create blank "padding" revisions in the target
repo as needed.</li>
  <li><strong>Optionally run an external shell script before each replayed commit</strong>,
to give the ability to dynamically exclude or modify files as part
of the replay.</li>
</ul>

<h2 id="requirements">Requirements</h2>
<ul>
  <li><strong>Python 2.6</strong> or higher.</li>
  <li><strong>Subversion 1.6</strong> or higher.</li>
  <li>Written for a UNIX-type environment, e.g. Linux, Mac OSX, etc. For
Windows-based usage, recommend using <a href="http://www.cygwin.com/">Cygwin</a> for
best compatibility.</li>
</ul>

<h2 id="overview">Overview</h2>
<p>This is a utility for replicating the revision history from a source path in
a source SVN repository to a target path in a target SVN repository. In other
words, it "replays the history" of a given source SVN repository/branch/path
into a target SVN repository/branch/path.</p>

<p>This can be useful to create filtered version of a source SVN repository. For
example, say that you have a huge SVN repository with a <em>lot</em> of old branch
history which is taking up a lot of disk-space and not serving a lot of purpose
going forward.  You can this utility to replay/filter just the "/trunk" SVN
history into a new repository, so that things like "svn log" and "svn blame"
will still show the correct (logical) history/ancestry, even though we end-up
generating new commits which will have newer commit-dates and revision #'s
(<em>though this script can optionally maintain the original commit-dates and
revision #'s if desired</em>).</p>

<p>While this replay process will obviously run faster if you're running between
both a local source and target repositories, none of this <em>requires</em> direct
access to the repo server. You could access both the source and target repo's
over standard <code class="highlighter-rouge">http://</code>, <code class="highlighter-rouge">svn://</code>, <code class="highlighter-rouge">svn+ssh://</code>, etc. methods.</p>

<h2 id="usage">Usage</h2>
<p>See <code class="highlighter-rouge">svnreplay.py --help</code>:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ ./svnreplay.py --help
svn2svn, version 1.7.0
&lt;http://nynim.org/code/svn2svn&gt; &lt;https://github.com/tonyduckles/svn2svn&gt;

Usage: svnreplay.py [OPTIONS] source_url target_url

Replicate (replay) history from one SVN repository to another. Maintain
logical ancestry wherever possible, so that 'svn log' on the replayed repo
will correctly follow file/folder renames.

Examples:
  Create a copy of only /trunk from source repo, starting at r5000
  $ svnadmin create /svn/target
  $ svn mkdir -m 'Add trunk' file:///svn/target/trunk
  $ svnreplay -av -r 5000 http://server/source/trunk file:///svn/target/trunk
    1. The target_url will be checked-out to ./_wc_target
    2. The first commit to http://server/source/trunk at/after r5000 will be
       exported &amp; added into _wc_target
    3. All revisions affecting http://server/source/trunk (starting at r5000)
       will be replayed to _wc_target. Any add/copy/move/replaces that are
       copy-from'd some path outside of /trunk (e.g. files renamed on a
       /branch and branch was merged into /trunk) will correctly maintain
       logical ancestry where possible.

  Use continue-mode (-c) to pick-up where the last run left-off
  $ svnreplay -avc http://server/source/trunk file:///svn/target/trunk
    1. The target_url will be checked-out to ./_wc_target, if not already
       checked-out
    2. All new revisions affecting http://server/source/trunk starting from
       the last replayed revision to file:///svn/target/trunk (based on the
       svn2svn:* revprops) will be replayed to _wc_target, maintaining all
       logical ancestry where possible.

Options:
      --version         show program's version number and exit
  -h, --help            show this help message and exit
  -v, --verbose         Enable additional output (use -vv or -vvv for more).
  -a, --archive         Archive/mirror mode; same as -UDP (see REQUIRES
                        below).
                        Maintain same commit author, same commit time, and
                        file/dir properties.
  -U, --keep-author     Maintain same commit authors (svn:author) as source.
                        (REQUIRES 'pre-revprop-change' hook script to allow
                        'svn:author' changes.)
  -D, --keep-date       Maintain same commit time (svn:date) as source.
                        (REQUIRES 'pre-revprop-change' hook script to allow
                        'svn:date' changes.)
  -P, --keep-prop       Maintain same file/dir SVN properties as source.
  -R, --keep-revnum     Maintain same rev #'s as source. Creates placeholder
                        target revisions (by modifying a 'svn2svn:keep-revnum'
                        property at the root of the target repo).
  -c, --continue        Continue from last source commit to target (based on
                        svn2svn:* revprops).
  -f, --force           Allow replaying into a non-empty target-repo folder.
  -r, --revision=ARG    Revision range to replay from source_url.
                        A revision argument can be one of:
                           START        Start rev # (end will be 'HEAD')
                           START:END    Start and ending rev #'s
                        Any revision # formats which SVN understands are
                        supported, e.g. 'HEAD', '{2010-01-31}', etc.
  -u, --log-author      Append source commit author to replayed commit
                        mesages.
  -d, --log-date        Append source commit time to replayed commit messages.
  -l, --limit=NUM       Maximum number of source revisions to process.
  -n, --dry-run         Process next source revision but don't commit changes
                        to target working-copy (forces --limit=1).
  -x, --verify          Verify ancestry and content for changed paths in
                        commit after every target commit or last target
                        commit.
  -X, --verify-all      Verify ancestry and content for entire target_url tree
                        after every target commit or last target commit.
      --pre-commit=CMD  Run the given shell script before each replayed
                        commit, e.g. to modify file-content during replay.
                        Called as: CMD [wc_path] [source_rev]
      --debug           Enable debugging output (same as -vvv).
</code></pre>
</div>

<h2 id="side-effects">Side Effects</h2>
<ul>
  <li>The source repo is treated as strictly read-only. We do log/info/export/etc.
actions from the source repo, to get the history to replay and to get the
file contents at each step along teh way.</li>
  <li>You must have commit access to the target repo. Additionally, for some of
the optional command-line args, you'll need access to the target repo to
setup hook scripts, e.g. "pre-revprop-change".</li>
  <li>This script will create some folders off of your current working directory:
    <ul>
      <li>"<code class="highlighter-rouge">_wc_target</code>": This is the checkout of the target_url, where we replay
actions into and where we commit to the target repo. You can safely
remove this directory after a run, and the script will do a fresh
"svn checkout" (if needed) when starting the next time.</li>
      <li>"<code class="highlighter-rouge">_wc_target_tmp</code>": This is a temporary folder, which will only be created
if using <code class="highlighter-rouge">--keep-revnum</code> mode and it should only exist for brief periods
of time. This is where we commit dummy/padding revisions to the target repo,
checking out the root folder of the target repo and modifying a
"<code class="highlighter-rouge">svn2svn:keep-revnum</code>" property, i.e. a small change to trigger a commit
and in a location that will likely go un-noticed in the final target repo.</li>
    </ul>
  </li>
</ul>

<h2 id="examples">Examples</h2>
<p><strong>Create a copy of only /trunk from source repo, starting at r5000</strong></p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ svnadmin create /svn/target
$ svn mkdir -m 'Add trunk' file:///svn/target/trunk
$ svnreplay -av -r 5000 http://server/source/trunk file:///svn/target/trunk
</code></pre>
</div>

<ol>
  <li>The <code class="highlighter-rouge">target_url</code> will be checked-out to <code class="highlighter-rouge">./_wc_target</code>.</li>
  <li>The first commit to <code class="highlighter-rouge">http://server/source/trunk</code> at/after r5000 will be
exported &amp; added into <code class="highlighter-rouge">_wc_target</code>.</li>
  <li>All revisions affecting <code class="highlighter-rouge">http://server/source/trunk</code> (starting at r5000)
will be replayed to <code class="highlighter-rouge">_wc_target</code>. Any add/copy/move/replaces that are
copy-from'd some path outside of /trunk (e.g. files renamed on a
/branch and branch was merged into /trunk) will correctly maintain
logical ancestry where possible.</li>
</ol>

<p><strong>Use continue-mode (-c) to pick-up where the last run left-off</strong></p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ svnreplay -avc http://server/source/trunk file:///svn/target/trunk
</code></pre>
</div>

<ol>
  <li>The <code class="highlighter-rouge">target_url</code> will be checked-out to <code class="highlighter-rouge">./_wc_target</code>, if not already
checked-out</li>
  <li>All new revisions affecting <code class="highlighter-rouge">http://server/source/trunk</code> starting from
the last replayed revision to <code class="highlighter-rouge">file:///svn/target/trunk</code> (based on the
"<code class="highlighter-rouge">svn2svn:*</code>" revprops) will be replayed to <code class="highlighter-rouge">_wc_target</code>, maintaining all
logical ancestry where possible.</li>
</ol>

<h2 id="credits">Credits</h2>
<p>This project borrows a lot of code from the "hgsvn" project.  Many thanks to
the folks who have contributed to the hgsvn project, for writing code that is
easily re-usable:</p>

<ul>
  <li><a href="http://pypi.python.org/pypi/hgsvn">http://pypi.python.org/pypi/hgsvn</a></li>
  <li><a href="https://bitbucket.org/andialbrecht/hgsvn/overview">https://bitbucket.org/andialbrecht/hgsvn/overview</a></li>
</ul>

<p>This project was originally inspired by this "svn2svn" project:<br />
<a href="http://code.google.com/p/svn2svn/">http://code.google.com/p/svn2svn/</a><br />
That project didn't fully meet my needs, so I forked and ended-up rewriting
the majority of the code.</p>

<h2 id="links">Links</h2>
<ul>
  <li>Introduction: "<strong><a href="http://nynim.org/blog/2012/02/01/svn2svn-replaying-svn-history/">svn2svn: Replaying SVN History</a></strong>"</li>
  <li>Project page: <a href="http://nynim.org/code/svn2svn">http://nynim.org/code/svn2svn</a></li>
  <li>Source code @ Github: <a href="https://github.com/tonyduckles/svn2svn">https://github.com/tonyduckles/svn2svn</a></li>
  <li>Source code @ git.nynim.org <a href="http://git.nynim.org/svn2svn.git">http://git.nynim.org/svn2svn.git</a></li>
</ul>

  </article>
</div>

      </div>
    </div>
  </div>

  <footer class="center">
  <div class="measure">
    <small>
      &copy; 2017 Tony Duckles.
      Powered by <a href="https://jekyllrb.com/">Jekyll</a>
      and <a href="https://github.com/octopress/octopress">Octopress 3</a>.
      Theme based on <a href="https://github.com/johnotander/pixyll">Pixyll</a>.
    </small>
  </div>
</footer>
</body>
</html>
